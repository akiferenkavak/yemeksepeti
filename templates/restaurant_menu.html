{% extends "base.html" %}

{% block title %}{{ restaurant.restaurant_name }} Menü{% endblock %}

{% block content %}
<div class="restaurant-header">
    <div class="restaurant-banner">
        {% if restaurant.image_path %}
            <img src="{{ url_for('static', filename='images/restaurants/' + restaurant.image_path) }}" alt="{{ restaurant.restaurant_name }}">
        {% else %}
            <img src="{{ url_for('static', filename='images/restaurants/default.jpg') }}" alt="Default image">
        {% endif %}
            <div class="restaurant-overlay">
            <h2>{{ restaurant.restaurant_name }}</h2>
            <div class="restaurant-meta">
                <span class="cuisine-type">{{ restaurant.cuisine_type }}</span>
                <div class="rating-display">
                    <span class="rating-value">{{ restaurant.rating }}</span>
                    <div class="stars">
                        {% for i in range(5) %}
                            {% if i < restaurant.rating|int %}
                                <span class="star filled">★</span>
                            {% elif i < (restaurant.rating|float + 0.5)|int %}
                                <span class="star half-filled">★</span>
                            {% else %}
                                <span class="star">☆</span>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="menu-container">
    <h3>Menü</h3>
    
    {% if menu_items %}
        <div class="menu-items">
            {% for item in menu_items %}
                <div class="menu-item">
                    <div class="menu-item-info">
                        <h4>{{ item.item_name }}</h4>
                        <p class="description">{{ item.description }}</p>
                        <p class="price">{{ "%.2f"|format(item.price) }} TL</p>
                    </div>
                    {% if session.logged_in and session.user_type == 'user' %}
                        <div class="add-to-cart">
                            <form action="{{ url_for('add_to_cart') }}" method="POST">
                                <input type="hidden" name="menu_item_id" value="{{ item.id }}">
                                <div class="quantity-control">
                                    <button type="button" class="quantity-btn minus">-</button>
                                    <input type="number" name="quantity" value="1" min="1" max="10" class="quantity-input">
                                    <button type="button" class="quantity-btn plus">+</button>
                                </div>
                                <button type="submit" class="btn btn-primary">Sepete Ekle</button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="no-items">Bu restoranda henüz menü öğesi bulunmamaktadır.</p>
    {% endif %}
</div>

<script>
    // Quantity control buttons
    document.addEventListener('DOMContentLoaded', function() {
        const minusButtons = document.querySelectorAll('.quantity-btn.minus');
        const plusButtons = document.querySelectorAll('.quantity-btn.plus');
        
        minusButtons.forEach(button => {
            button.addEventListener('click', function() {
                const input = this.parentNode.querySelector('.quantity-input');
                let value = parseInt(input.value);
                if (value > 1) {
                    input.value = value - 1;
                }
            });
        });
        
        plusButtons.forEach(button => {
            button.addEventListener('click', function() {
                const input = this.parentNode.querySelector('.quantity-input');
                let value = parseInt(input.value);
                if (value < 10) {
                    input.value = value + 1;
                }
            });
        });
    });
</script>
{% endblock %}